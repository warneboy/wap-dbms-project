<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cart - DreamBasket</title>
<link rel="stylesheet" href="cart.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
  body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f7f7f7;
}

header {
  background-color: #293a55; /* changed from #0fe4e4 */
  color: white;
  padding: 15px;
  text-align: center;
}

header a {
  color: white;
  text-decoration: none;
  margin-top: 10px;
  display: inline-block;
}

main {
  max-width: 900px;
  margin: 20px auto;
  background-color: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
}

th, td {
  padding: 12px;
  text-align: left;
  border-bottom: 1px solid #ddd;
}

th {
  background-color: #293a55; /* changed from #0fe4e4 */
  color: white;
}

td img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 5px;
}

.cart-summary {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.cart-summary button {
  background-color: #293a55; /* changed from #0fe4e4 */
  border: none;
  padding: 10px 20px;
  color: white;
  font-weight: bold;
  border-radius: 5px;
  cursor: pointer;
}

.cart-summary button:hover {
  background-color: #1f2a44; /* slightly darker hover effect */
}

/* Unauthorized modal */
.overlay {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.popup-container {
  background: white;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  width: 300px;
}

.popup-container button.close-btn {
  float: right;
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
}

</style>
</head>
<body>
<header>
  <h1>Your Shopping Cart</h1>
  <a href="index.html">← Continue Shopping</a>
</header>

<main>
  <table id="cartTable">
    <thead>
      <tr>
        <th>Product</th>
        <th>Price (₹)</th>
        <th>Quantity</th>
        <th>Subtotal (₹)</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="cartBody">
      <!-- Cart items will be loaded here -->
    </tbody>
  </table>

  <div class="cart-summary">
    <h3>Total: ₹<span id="totalAmount">0</span></h3>
    <button id="checkoutBtn">Checkout</button>
  </div>
</main>

<!-- Unauthorized Popup -->
<div class="overlay" id="unauthModal" style="display:none;">
  <div class="popup-container">
    <button class="close-btn" onclick="closeUnauthModal()">×</button>
    <h2>Unauthorized</h2>
    <p>Only customers can add products to the cart.</p>
  </div>
</div>

<script>
  // Load cart from localStorage
let cart = JSON.parse(localStorage.getItem("cart")) || [];

// Update the cart table
function renderCart() {
  const cartBody = document.getElementById("cartBody");
  const totalAmount = document.getElementById("totalAmount");
  cartBody.innerHTML = "";
  let total = 0;

  cart.forEach((item, index) => {
    const subtotal = item.price * item.quantity;
    total += subtotal;

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>
        <img src="http://localhost:3000/uploads/${item.image}" alt="${item.name}"> ${item.name}
      </td>
      <td>${item.price.toFixed(2)}</td>
      <td>
        <input type="number" min="1" value="${item.quantity}" onchange="updateQuantity(${index}, this.value)">
      </td>
      <td>${subtotal.toFixed(2)}</td>
      <td><button onclick="removeItem(${index})">Remove</button></td>
    `;
    cartBody.appendChild(row);
  });

  totalAmount.textContent = total.toFixed(2);
}

// Add product to cart
function addToCart(item) {
  const user = JSON.parse(localStorage.getItem("user"));

  if (!user) {
    alert("Please login first!");
    return;
  }

  if (user.id.startsWith("S") || user.id.startsWith("A")) {
    document.getElementById("unauthModal").style.display = "flex";
    return;
  }

  // Check if product already in cart
  const existing = cart.find(p => p.p_id === item.p_id);
  if (existing) {
    existing.quantity += 1;
  } else {
    cart.push({ ...item, quantity: 1 });
  }

  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

// Remove item
function removeItem(index) {
  cart.splice(index, 1);
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

// Update quantity
function updateQuantity(index, value) {
  const qty = parseInt(value);
  if (qty < 1) return;
  cart[index].quantity = qty;
  localStorage.setItem("cart", JSON.stringify(cart));
  renderCart();
}

// Close unauthorized modal
function closeUnauthModal() {
  document.getElementById("unauthModal").style.display = "none";
}

// Checkout button
document.getElementById("checkoutBtn").addEventListener("click", () => {
  if (!cart.length) return alert("Cart is empty!");
  alert("Checkout successful! Total: ₹" + document.getElementById("totalAmount").textContent);
  localStorage.removeItem("cart");
  cart = [];
  renderCart();
});

// Initial render
renderCart();


</script>
</body>
</html>
